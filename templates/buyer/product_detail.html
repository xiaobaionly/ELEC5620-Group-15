{% extends "_base.html" %}
{% block title %}{{ p.name }}{% endblock %}

{% block content %}
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      {% if p.image %}
        <img src="{{ p.image.url }}" class="w-full rounded shadow" alt="{{ p.name }}">
      {% endif %}
    </div>

    <div>
      <h2 class="text-3xl font-bold mb-2">{{ p.name }}</h2>
      <p class="text-gray-700 mb-2">Price: <strong>${{ p.base_price }}</strong> / {{ p.unit }}</p>
      <p class="text-gray-700 mb-4">Stock: {{ p.stock }}</p>

      <h3 class="font-semibold mt-4">AI Description (Chinese)</h3>
      <p class="whitespace-pre-wrap">{{ p.ai_description_zh|default:"Not generated yet" }}</p>

      <h3 class="font-semibold mt-4">AI Description (English)</h3>
      <p class="whitespace-pre-wrap">{{ p.ai_description_en|default:"Not generated yet" }}</p>

      <h3 class="font-semibold mt-6">AI Pricing & Logistics Suggestions</h3>
      {% with ps=p.price_suggestions.last %}
        {% if ps %}
          <p class="text-sm">
            Suggested Price: <strong>${{ ps.suggested_price }}</strong> ({{ ps.rationale }})
          </p>
        {% else %}
          <p class="text-sm text-gray-500">No AI pricing suggestion available.</p>
        {% endif %}
      {% endwith %}

      {% with lg=p.logistics.last %}
        {% if lg %}
          <p class="text-sm">
            Shipping: {{ lg.region }} · {{ lg.carrier }} · approx. {{ lg.estimated_days }} days · cost ${{ lg.cost_estimate }}
          </p>
        {% else %}
          <p class="text-sm text-gray-500">No logistics estimation available.</p>
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <hr class="my-6">

  <!-- Ask AI section (plain textarea, full control, English-only) -->
  <h3 class="text-xl font-semibold mb-2">Ask AI (about price, logistics, or stock)</h3>
  <form method="post" class="space-y-3 bg-white p-4 rounded shadow">
    {% csrf_token %}

    <label class="block text-sm font-medium text-gray-700 mb-1" for="{{ form.question.id_for_label }}">
      Your question
    </label>

    <textarea
      id="{{ form.question.id_for_label }}"
      name="{{ form.question.html_name }}"
      rows="3"
      placeholder="Ask your question in English…"
      class="w-full rounded border border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
    >{{ form.question.value|default_if_none:'' }}</textarea>

    {% if form.question.errors %}
      <p class="text-red-600 text-sm mt-1">{{ form.question.errors.0 }}</p>
    {% endif %}

    <button class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition" type="submit">
      Submit
    </button>
  </form>

  {% if ai_answer %}
    <div class="mt-4 p-4 bg-gray-100 rounded">
      <div class="font-semibold mb-1">AI Answer:</div>
      <pre class="whitespace-pre-wrap">{{ ai_answer }}</pre>
    </div>
  {% endif %}
{% endblock %}
