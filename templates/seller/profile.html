{% extends "_base.html" %}
{% block title %}Seller Profile{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto">
  <h1 class="text-2xl font-bold text-green-700 mb-4">Seller Profile</h1>

  <!-- Top account info card -->
  <div class="bg-white/80 border border-green-100 rounded-xl p-5 mb-5">
    <div class="flex items-center gap-4">
      <div class="h-12 w-12 rounded-full bg-green-100 text-green-700 flex items-center justify-center font-bold">
        {{ account_username|first|upper }}{{ account_username|slice:"1"|first|upper }}
      </div>
      <div class="text-gray-700">
        <div class="font-medium">{{ account_username }}</div>
        <div class="text-sm text-gray-500">{{ account_email|default:"—" }}</div>
      </div>
    </div>
  </div>

  <!-- Form card -->
  <form method="post" enctype="multipart/form-data" class="bg-white/80 border border-green-100 rounded-xl p-5">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="mb-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    {% for hf in form.hidden_fields %}{{ hf }}{% endfor %}

    <!-- Basic info grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
      <div>
        <label class="block text-sm text-gray-600 mb-1" for="{{ form.company_name.id_for_label }}">Company Name</label>
        {{ form.company_name }}
        {% for e in form.company_name.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
      </div>

      {% if form.contact_name %}
      <div>
        <label class="block text-sm text-gray-600 mb-1" for="{{ form.contact_name.id_for_label }}">Contact Name</label>
        {{ form.contact_name }}
        {% for e in form.contact_name.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
      </div>
      {% endif %}

      {% if form.phone %}
      <div>
        <label class="block text-sm text-gray-600 mb-1" for="{{ form.phone.id_for_label }}">Phone</label>
        {{ form.phone }}
        {% for e in form.phone.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
      </div>
      {% endif %}

      {% if form.email %}
      <div>
        <label class="block text-sm text-gray-600 mb-1" for="{{ form.email.id_for_label }}">Email</label>
        {{ form.email }}
        {% for e in form.email.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
      </div>
      {% endif %}

      {% if form.address %}
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-600 mb-1" for="{{ form.address.id_for_label }}">Address</label>
        {{ form.address }}
        {% for e in form.address.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
      </div>
      {% endif %}

      {% if form.description %}
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-600 mb-1" for="{{ form.description.id_for_label }}">Description</label>
        {{ form.description }}
        {% for e in form.description.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Company Logo section (separated) -->
    {% if form.logo %}
    <div class="md:col-span-2 mt-8 pt-6 border-t border-gray-200">
      <h2 class="text-lg font-semibold text-green-700 mb-3">Company Logo</h2>
      <div class="bg-gray-50/60 rounded-lg p-4">
        <label class="block text-sm text-gray-600 mb-2" for="{{ form.logo.id_for_label }}">Logo</label>
        <div class="flex items-start gap-4">
          <label for="logo-input"
                 class="inline-flex items-center justify-center px-4 py-2 text-sm rounded-lg bg-green-600 text-white hover:bg-green-700 cursor-pointer">
            Choose File
          </label>
          <input id="logo-input" type="file" name="{{ form.logo.name }}" accept="image/*" class="sr-only">
          <span id="logo-filename" class="text-sm text-gray-600">No file chosen</span>

          <div class="relative w-24 h-24 rounded overflow-hidden bg-white border ml-auto">
            {% if form.instance.logo %}
              <img id="logo-preview" src="{{ form.instance.logo.url }}"
                   class="absolute inset-0 block w-full h-full object-cover" alt="current logo">
            {% else %}
              <img id="logo-preview"
                   class="absolute inset-0 block w-full h-full object-cover hidden" alt="logo preview">
              <span id="logo-placeholder"
                    class="absolute inset-0 flex items-center justify-center text-gray-400 text-[11px]">
                Preview
              </span>
            {% endif %}
          </div>
        </div>
        {% for e in form.logo.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
        <p class="text-xs text-gray-500 mt-2">Recommended logo size ≥ 256×256, PNG/JPG.</p>
      </div>
    </div>
    {% endif %}

    <!-- Business License section (separated) -->
    {% if form.business_license %}
    <div class="md:col-span-2 mt-10 pt-6 border-t border-gray-200">
      <h2 class="text-lg font-semibold text-green-700 mb-3">Business License</h2>
      <div class="bg-gray-50/60 rounded-lg p-4">
        <label class="block text-sm text-gray-600 mb-2" for="{{ form.business_license.id_for_label }}">Business License</label>
        <div class="flex items-center gap-4">
          <label for="license-input"
                 class="inline-flex items-center justify-center px-4 py-2 text-sm rounded-lg bg-green-600 text-white hover:bg-green-700 cursor-pointer">
            Choose File
          </label>
          <input id="license-input" type="file" name="{{ form.business_license.name }}"
                 accept="application/pdf,image/*" class="sr-only">
          <span id="license-filename" class="text-sm text-gray-600">No file chosen</span>
        </div>

        {% if form.instance.business_license %}
          <p class="text-xs text-gray-500 mt-2">
            Current: <a class="underline text-green-700 hover:text-green-900" href="{{ form.instance.business_license.url }}" target="_blank">View file</a>
          </p>
        {% endif %}
        {% for e in form.business_license.errors %}<p class="text-red-600 text-xs mt-1">{{ e }}</p>{% endfor %}
        <p class="text-xs text-gray-500 mt-2">Accepted formats: PDF/JPG/PNG.</p>
      </div>
    </div>
    {% endif %}

    <div class="mt-8 flex items-center gap-3">
      <button type="submit" class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700">Save</button>
      <a href="{% url 'seller-dashboard' %}" class="text-gray-600 hover:text-gray-800">Back</a>
    </div>
  </form>
</div>

<!-- Custom English buttons + remove unwanted placeholders -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Remove unwanted placeholders (force English-only look)
    const ids = ["id_company_name", "id_phone"];
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.placeholder = "";
    });

    // File inputs + preview
    const logoInput = document.getElementById('logo-input');
    const logoFileName = document.getElementById('logo-filename');
    const logoPreview = document.getElementById('logo-preview');
    const logoPlaceholder = document.getElementById('logo-placeholder');

    const licInput = document.getElementById('license-input');
    const licFileName = document.getElementById('license-filename');

    function setFileName(el, name) {
      if (el) el.textContent = name && name.trim() ? name : 'No file chosen';
    }
    function previewImage(inputEl, imgEl, placeholderEl) {
      const file = inputEl && inputEl.files && inputEl.files[0];
      if (!file || !imgEl) return;
      const url = URL.createObjectURL(file);
      imgEl.src = url;
      imgEl.onload = () => URL.revokeObjectURL(url);
      imgEl.classList.remove('hidden');
      if (placeholderEl) placeholderEl.classList.add('hidden');
    }

    if (logoInput) {
      logoInput.addEventListener('change', () => {
        const f = logoInput.files && logoInput.files[0];
        setFileName(logoFileName, f ? f.name : '');
        previewImage(logoInput, logoPreview, logoPlaceholder);
      });
    }
    if (licInput) {
      licInput.addEventListener('change', () => {
        const f = licInput.files && licInput.files[0];
        setFileName(licFileName, f ? f.name : '');
      });
    }
  });
</script>
{% endblock %}
